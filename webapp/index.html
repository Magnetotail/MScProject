<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="Community Detection Application">
        <meta name="author" content="Andrew Walker">

        <title>Community Detection</title>

        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/plugins/jquery.qtip.css">
        <link rel="stylesheet" href="css/plugins/alertify.core.css">
        <link rel="stylesheet" href="css/plugins/alertify.default.css">

        <script src="js/plugins/jquery.min.js"></script>
        <script src="js/plugins/arbor.js"></script>
        <script src="js/plugins/cytoscape.min.js"></script>
        <script src="js/plugins/jquery.qtip.js"></script>
        <script src="js/plugins/cytoscape.js-qtip.js"></script>
        <script src="js/plugins/knockout-3.1.0.js"></script>
        <script src="js/plugins/alertify.min.js"></script>
    </head>

    <body>

        <div data-bind="visible: loadingGraph">
            <div id="overlay"></div>
            <center>
                <div id="progressBar" class="big-green"><div></div></div>
            </center>
        </div>

        <div id="beforeUpload" data-bind="visible: !graph()">
            <h1>Community Detection</h1>
            <hr>

            <p>Visualise the community structures in graphs.</p>

            <form id="uploadForm" action="upload" method="post" enctype="multipart/form-data">
                <fieldset>

                    <input id= "fileInput" type="file" name="file"> <br>

                    <label for="filetype">&nbsp; &nbsp; &nbsp; &nbsp; Graph file type:</label>
                    <select id="filetype" class="upload" name="filetype">
                        <option>GML</option>
                        <option>Edgelist</option>
                    </select> <br>

                    <label for="algorithm">Detection Algorithm:</label>
                    <select id="algorithm" class="upload" name="algorithm">
                        <option>Louvain Method</option>
                        <option>Label Propagation</option>
                        <option>ORCA</option>
                    </select> <br>

                    <input class="myButton upload" data-bind="click: uploadGraph" type="button" value="Process Graph" /> <br>

                </fieldset>
            </form>  
        </div>

        <div id="afterUpload" class="scroll-x" data-bind="visible: graph">

            <div id="topMenu" class="top limWidth">
                <center>
                    <div id="back" class="menuSection" data-bind="visible: hasHistory">
                        <span class="help topHelp" data-bind="visible: showHelp">?</span>
                        <div class="helpContent">Help text to be replaced...</div>
                        <input class="myButton backButton" data-bind="click: backHistory" type="button" value="Back" />
                    </div>

                    <div id="navigation" class="menuSection" data-bind="visible: !isShowingCommunity()">
                        <span class="help topHelp" data-bind="visible: showHelp">?</span>
                        <div class="helpContent">Help text to be replaced...</div>
                        View level:
                        <span class="detail">
                            <select class="view" data-bind="options: availableLevels, value: drillLevel, event: { change: updateGraph }"></select>
                        </span>

                        <span class="help topHelp" data-bind="visible: showHelp">?</span>
                        <div class="helpContent">Help text to be replaced...</div>
                        Colour level: 
                        <span class="detail">
                            <select class="view" data-bind="options: colourLevels, value: colourLevel, event: { change: updateGraph }"></select>
                        </span>

                        <span class="help topHelp" data-bind="visible: showHelp">?</span>
                        <div class="helpContent">Help text to be replaced...</div>
                        Modularity: 
                        <span class="detail" data-bind="text: modularity"></span>
                    </div>

                    <div id="navigation" class="menuSection" data-bind="visible: isShowingCommunity">
                        Viewing community 
                        <span class="detailCommunity" data-bind="text: currentCommunityShown"></span>

                        at level 
                        <span class="detailCommunity" data-bind="text: currentLevel"></span>

                        with colour level 
                        <span class="detailCommunity" data-bind="text: currentColourLevel">.</span>
                    </div>

                    <div id="labelling" class="menuSection">
                        <span class="help topHelp" data-bind="visible: showHelp">?</span>
                        <div class="helpContent">Help text to be replaced...</div>
                        Node labels: 
                        <span class="detail">
                            <select class="view" data-bind="options: availableNodeData, value: nodeDataChoice, event: { change: toggleLabels }"></select>
                        </span>
                    </div>
                </center>
            </div>


            <div id="graph" class="middle">
                <div id="tooBig" data-bind="visible: currentViewTooBig">
                    The level you selected is too big to visualise. You can download the level as a GML file or try and view a different level of the hierarchy.
                </div>

                <div id="cy" data-bind="click: updateSelectedCommunity, visible: !currentViewTooBig()"></div>

                <div id="community" class="left" data-bind="visible: !currentViewTooBig() && hasSelectedCommunity()">
                    <h1>Community <span data-bind="text: selectedCommunity"></span></h1>
                    <h3>Size: <span data-bind="text: selectedCommunitySize"></span></h3>

                    <hr>

                    <div id="navigateCommunity" data-bind="visible: communityNoOfPages() > 1">
                        <input data-bind="click: firstPage, disable: isFirstPage" type="button" class="myButton pageButton" value="<<" />
                        <input data-bind="click: previousPage, disable: isFirstPage" type="button" class="myButton pageButton" value="<" />
                        page <span data-bind="text: communityPageIndex"></span> of <span data-bind="text: communityNoOfPages"></span>
                        <input data-bind="click: nextPage, disable: isLastPage" type="button" class="myButton pageButton" value=">" />
                        <input data-bind="click: lastPage, disable: isLastPage" type="button" class="myButton pageButton" value=">>" />
                    </div>

                    <div class="resultTable scroll-x">
                        <center>
                        <table>
                            <thead>
                                <tr>
                                    <!-- ko foreach: tableHeadings -->
                                        <th data-bind="text: $data"></th>
                                    <!-- /ko -->
                                </tr>
                            </thead>
                            <tbody data-bind="foreach: community">
                                <tr>
                                    <!-- ko foreach: Object.keys($data.data.metadata).map(function (key) {
                                                        return $data.data.metadata[key];
                                                    }); 
                                    -->                                
                                        <td data-bind="text: $data"></td>
                                    <!-- /ko -->
                                </tr>
                            </tbody>
                        </table>
                        </center>
                    </div>
                    
                    <div data-bind="visible: loadingTable">Loading table...</div>

                    <hr>

                    <div id="drillIntoCommunity">
                        <span class="help topHelp" data-bind="visible: showHelp">?</span>
                        <div class="helpContent">Help text to be replaced...</div>
                        View level:
                        <span class="detail">
                            <select class="view" data-bind="options: communityAvailableLevels, value: communityDrillLevel"></select>
                        </span>

                        <span class="help topHelp" data-bind="visible: showHelp">?</span>
                        <div class="helpContent">Help text to be replaced...</div>
                        Colour level: 
                        <span class="detail">
                            <select class="view" data-bind="options: communityColourLevels, value: communityColourLevel"></select>
                        </span> <br>

                        <span data-bind="visible: isCommunityTooBig">Too many nodes at this level to view.</span>

                        <input class="myButton communityButton" data-bind="click: updateCommunity, visible: !isCommunityTooBig()" type="button" value="View Level" />
                        <input class="myButton communityButton" data-bind="click: downloadCommunity" type="button" value="Download GML" />
                    </div>
                </div>
            </div>


            <div class="bottom limWidth">
                <center>
                    <div id="options" class="menuSection">
                        <a href="javascript:document.location.reload();">
                            <input class="myButton graphButton" type="button" value="Upload new graph" />
                        </a>

                        <input class="myButton graphButton" data-bind="click: turnHelpOn, visible: !showHelp()" type="button" value="Show help" />
                        <input class="myButton graphButton" data-bind="click: turnHelpOff, visible: showHelp" type="button" value="Hide help" />
                    </div>

                    <div id="download" class="menuSection">
                        <span class="help bottomHelp" data-bind="visible: showHelp">?</span>
                        <div class="helpContent">Help text to be replaced...</div>
                        <input class="myButton graphButton" data-bind="click: downloadGraph" type="button" value="Download GML" />
                        
                        <span class="help bottomHelp" data-bind="visible: showHelp">?</span>
                        <div class="helpContent">Help text to be replaced...</div>
                        <a id='layoutSettings'>Layout Settings</a>
                        <div class="tooltiptext">
                            <ul class="layoutContainer">
                                <li>
                                    <span class="layoutOption">Repulsion:</span><input type="range" name="points" min="0" max="10000" data-bind="value: layoutRepulsion" />
                                </li>
                                <li>
                                    <span class="layoutOption">Stiffness:</span><input type="range" name="points" min="0" max="1000" data-bind="value: layoutStiffness" />
                                </li>
                                <li>
                                    <span class="layoutOption">Friction:</span><input type="range" name="points" min="0" max="1000" data-bind="value: layoutFriction" />
                                </li>
                                <li>
                                    <label for="arborTimeHigh">Time(secs):</label>
                                    <input data-bind="value: layoutTime" type="number" min="1" max="300" step="1" value="10" id="arborTimeHigh">
                                </li>
                                <li>
                                    <input class="myButton layoutButton" data-bind="visible: !hasDefaultSettings(), click: restoreDefaultSettings" type="button" value="Restore defaults" />
                                </li>
                                <li>
                                    <input class="myButton layoutButton" data-bind="visible: !isArborRunning(), click: refreshLayout" type="button" value="Refresh layout" />
                                    <input class="myButton layoutButton red" data-bind="visible: isArborRunning, click: cancelLayout" type="button" value="Stop layout" />
                                </li>
                            </ul>
                        </div>
                    </div>
                </center>
            </div>

        </div>

        
        <script src="js/cytoscape-commdet.js"></script>
        <script src="js/scripts.js"></script>
        <script src="js/viewModel.js"></script>
        
    </body>
</html>
